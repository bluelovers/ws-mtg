"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("mtg-decklist-parser2"),e=require("array-hyper-unique"),t=require("scryfall-api");function n(r){return r&&"object"==typeof r&&"default"in r?r:{default:r}}var a=n(require("bluebird"));function o(r){let e=r.trim().split(/—/).filter((r=>r.length));if(!e.length||e.length>2)throw new SyntaxError(`Invalid card type: ${r}`);return e.map((r=>r.trim().split(/\s+/).filter((r=>r.length))))}function i(r){var e;const t=r[0].join(" ");let n=null===(e=r[1])||void 0===e?void 0:e.filter((r=>r.length));return null!=n&&n.length?`${t} — ${n.join(" ")}`:t}function s(r){return r.split(/\s*\/\/\s*/).map(o)}function l(r){let t=r.reduce(((r,e)=>(r.push(...e[0]),r)),[]);return e.array_unique_overwrite(t)}const u=Symbol.for("raw-card");class d extends r.CardModel{constructor(r,e){var t;super({name:r.name,set:r.set.toUpperCase(),collectors:r.collector_number}),this.amount=e,this[u]=r,this.mtgoID=null===(t=r.mtgo_id)||void 0===t?void 0:t.toString(),this._init()}_init(){this.rarity=this[u].rarity,this.mainTypes=l(s(this[u].type_line))}}class c extends r.AbstractDeck{constructor(e){var t,n;super(),n="scryfall",(t=r.SymDecklistType)in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n,this.valid=!1,null!=e&&e.length&&(e.forEach((r=>{this.addByApiResult(r)})),this.valid=!0)}addByApiResult(r,e,t){var n;null!==(n=e)&&void 0!==n||(e="deck");const a=this._newCardModel(r,t);return"commander"===e||"companion"===e?this[e]=a:this[e].push(a),a}_newCardModel(r,e){const t=new d(r);return t.amount=null!=e?e:t.amount,t}}const p=["Sorcery","Instant","Planeswalker","Enchantment","Artifact","Creature","Land"],m=["Commander","Companion","Creature","Planeswalker","Artifact","Enchantment","Instant","Sorcery","Land","Sideboard","Uncategorized"];function y(r,e){let t;return r=[r].flat(),(null!=e?e:p).find((e=>{if(r.includes(e))return t=e,!0})),t}function f(r){var e,t;const n=h(r.deck);return r.commander&&n.Commander.push(r.commander),r.companion&&n.Companion.push(r.companion),null!==(e=r.sideboard)&&void 0!==e&&e.length&&n.Sideboard.push(...r.sideboard),null===(t=n.Land)||void 0===t||t.sort(((r,e)=>{let t=r.mainTypes.includes("Basic");return t!==e.mainTypes.includes("Basic")?t?-1:1:0})),n}function h(r){return r.reduce(((r,e)=>{var t;let n=y(e.mainTypes);return null!==(t=r[n])&&void 0!==t||(r[n]=[]),r[n].push(e),r}),{})}function v(r){const e=[];return m.forEach((t=>{let n=r[t];null!=n&&n.length&&(e.push(t),n.forEach((r=>{var t;let n=`${null!==(t=r.amount)&&void 0!==t?t:1}x ${r.name}`;e.push(n)})),e.push(""))})),e}function C(r){return v(r).join("\n")}function x(r){var e;return console.log("start",r.toCardString()),t.Cards.byName(r.name,null===(e=r.set)||void 0===e?void 0:e.toLowerCase())}var S;exports.EnumGroupCardType=void 0,(S=exports.EnumGroupCardType||(exports.EnumGroupCardType={})).Sorcery="Sorcery",S.Instant="Instant",S.Planeswalker="Planeswalker",S.Enchantment="Enchantment",S.Artifact="Artifact",S.Creature="Creature",S.Land="Land",S.Commander="Commander",S.Uncategorized="Uncategorized",S.Sideboard="Sideboard",S.Companion="Companion",exports.GROUP_CARD_TYPE_DISPLAY_PRIORITY=m,exports.GROUP_CARD_TYPE_PRIORITY=p,exports.ScryfallCardModel=d,exports.ScryfallDecklist=c,exports.SymRaw=u,exports._queryCard=x,exports.arrayifyGroupRecord=v,exports.cardTypeGroupByPriority=y,exports.default=c,exports.getCardMainTypes=l,exports.groupScryfallCardList=h,exports.groupScryfallDecklist=f,exports.importByDecklist=async function(r,e){var t;null!==(t=e)&&void 0!==t||(e=new c);const n=(r,t,n)=>x(r).then((t=>{var a;return null===(a=e)||void 0===a?void 0:a.addByApiResult(t,"deck",null!=n?n:r.amount)}));return await a.default.mapSeries(["deck","sideboard"],(e=>a.default.mapSeries(r[e].slice(),(r=>r&&n(r,0,r.amount))))),await a.default.mapSeries(["companion","commander"],(e=>{const t=r[e];return t&&n(t,0,t.amount)})),e},exports.parseScryfallCardType=o,exports.parseScryfallCardTypeExtra=s,exports.stringifyGroupRecord=C,exports.stringifyScryfallCardType=i,exports.stringifyScryfallCardTypeExtra=function(r){return r.map(i).join(" // ")},exports.stringifyScryfallDecklist=function(r){return C(f(r))};
//# sourceMappingURL=index.cjs.production.min.js.map
