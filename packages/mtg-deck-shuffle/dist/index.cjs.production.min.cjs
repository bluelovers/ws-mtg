"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("mtg-decklist-to-library"),e=require("@lazy-random/simple-wrap"),n=require("@lazy-random/original-math-random"),t=require("@lazy-random/df-array"),s=require("array-chunk-split"),a=require("mtg-base-land"),o=require("array-group-to-record"),i=require("distribute-group-to-array"),u=require("@lazy-random/util-distributions");let d;function l(r){var t,s;return null!==(t=null==r?void 0:r.random)&&void 0!==t?t:null!==(s=d)&&void 0!==s?s:d=e.simpleWrap(n._MathRandom)}function h(r,e,n){return t.dfArrayShuffle(r,e,n)()}function p(r,e,n){let t=function(r,e){return s.arrayChunkSplit(r,null!=e?e:12)}(r,null==e?void 0:e.maxChunkLength);return h(l(e),t,!0).flat()}function f(r){return r.reduce(((r,e)=>{let n=a.parseSnowCoveredOrBaseLand(e.name);return n?null!=n&&n.snow?r.snowLands.push(e):r.baseLands.push(e):r.others.push(e),r}),{baseLands:[],snowLands:[],others:[]})}function c(r){return o.arrayGroupToRecord(r,{getKey:(r,e,n)=>r.name})}function L(r){return i.distributeGroupToArray(r,{groupArraySize:4})}function y(r,e,n){let t=f(r),s=i._createGroupArray(4),a=0;for(t.baseLands=L(c(t.baseLands)),t.snowLands=L(c(t.snowLands));t.baseLands.length||t.snowLands.length||t.others.length;){for(let r=0;r<4;r++){let e=t.others.pop();var o,u;s[r].push(e),e&&a%4!=0||(s[r].push(null!==(o=t.baseLands.pop())&&void 0!==o?o:t.snowLands.pop()),s[r].push(null!==(u=t.baseLands.pop())&&void 0!==u?u:t.snowLands.pop()))}a++}return s.flat().filter((r=>r))}function m(r,e,n){let s;if(r=r.slice(),!1===(null==e?void 0:e.ensureLands))return r;if(s=!0===(null==e?void 0:e.ensureLands)?2:Math.max(Math.min(2,0|(null==e?void 0:e.ensureLands)||2),0),n.handSize<6||s<=0)return r;6===n.handSize&&(s=1);const o=r.slice(0,n.handSize),i=f(o),u=i.snowLands.length+i.baseLands.length-s;if(u>0){const s=function(r,e){return e|=0,r.reduce(((r,n,t)=>(t>=e&&a.parseSnowCoveredOrBaseLand(n.name)&&r.push(t),r)),[])}(r,n.handSize),d=l(e),h=t.dfArrayUnique(d,s,u);let p=t.dfArrayUnique(d,i.others,u);for(let e=0;e<u;e++){const e=p(),n=h(),t=o.findIndex((r=>r.name===e.name));if(-1===t)throw new Error("Something wrong");const s=r[n];r[n]=r[t],o[t]=r[t]=s}}return r}class DeckLibraryWithShuffle extends r.DeckLibrary{constructor(r,e){super(r,e)}options(r){return{...this._options,...r}}shuffleStarting(){var r;let e=this.options();const n=l(e);null!==(r=e.ensureLands)&&void 0!==r||(e.ensureLands=u.int(n,0,2));let t=[y,p,m].reduce(((r,n)=>n(r,e,this)),this.cards);this.cards=t,this._shuffleStarting=!0}shuffle(r){h(l(this.options()),this.cards,!0)}}exports.DeckLibraryWithShuffle=DeckLibraryWithShuffle,exports.default=DeckLibraryWithShuffle,exports.distributeCards=y,exports.ensureLands=m,exports.splitThenMerge=p;
//# sourceMappingURL=index.cjs.production.min.cjs.map
