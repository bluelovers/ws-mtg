"use strict";var e=require("mtg-decklist-to-library"),n=require("random-extra/preset/seedrandom"),r=require("array-chunk-split"),s=require("mtg-base-land");function t(e){var r;return null!==(r=null==e?void 0:e.random)&&void 0!==r?r:n.seedrandom}function a(e,n,s){let a=function(e,n){return r.arrayChunkSplit(e,null!=n?n:12)}(e,null==n?void 0:n.maxChunkLength);return t(n).arrayShuffle(a,!0).flat()}function o(e){return e.reduce(((e,n)=>{let r=s.parseSnowCoveredOrBaseLand(n.name);return r?null!=r&&r.snow?e.snowLands.push(n):e.baseLands.push(n):e.others.push(n),e}),{baseLands:[],snowLands:[],others:[]})}function u(e){return e.reduce(((e,n)=>{var r,s;return null!==(s=e[r=n.name])&&void 0!==s||(e[r]=[]),e[n.name].push(n),e}),{})}function l(e){const n=[];for(let r=0;r<e;r++)n.push([]);return n}function i(e){let n=l(4);const r=Object.keys(e);let s,t=n.length-1;do{for(let o of r){var a;s=null===(a=e[o])||void 0===a?void 0:a.pop(),s?n[t%n.length].push(s):delete e[o]}s&&t++}while(Object.keys(e).length);return n.flat()}function d(e,n,r){let s=o(e),t=l(4),a=0;for(s.baseLands=i(u(s.baseLands)),s.snowLands=i(u(s.snowLands));s.baseLands.length||s.snowLands.length||s.others.length;){for(let e=0;e<4;e++){let n=s.others.pop();var d,h;t[e].push(n),n&&a%4!=0||(t[e].push(null!==(d=s.baseLands.pop())&&void 0!==d?d:s.snowLands.pop()),t[e].push(null!==(h=s.baseLands.pop())&&void 0!==h?h:s.snowLands.pop()))}a++}return t.flat().filter((e=>e))}function h(e,n,r){let a;if(e=e.slice(),!1===(null==n?void 0:n.ensureLands))return e;if(a=!0===(null==n?void 0:n.ensureLands)?2:Math.max(Math.min(2,0|(null==n?void 0:n.ensureLands)||2),0),r.handSize<6||a<=0)return e;6===r.handSize&&(a=1);const u=e.slice(0,r.handSize),l=o(u),i=l.snowLands.length+l.baseLands.length-a;if(i>0){const a=function(e,n){return n|=0,e.reduce(((e,r,t)=>(t>=n&&s.parseSnowCoveredOrBaseLand(r.name)&&e.push(t),e)),[])}(e,r.handSize),o=t(n),d=o.dfArrayUnique(a,i);let h=o.dfArrayUnique(l.others,i);for(let n=0;n<i;n++){const n=h(),r=d(),s=u.findIndex((e=>e.name===n.name));if(-1===s)throw new Error("Something wrong");const t=e[r];e[r]=e[s],u[s]=e[s]=t}}return e}class f extends e.DeckLibrary{constructor(e,n){super(e,n)}options(e){return{...this._options,...e}}shuffleStarting(){var e;let n=this.options();const r=t(n);null!==(e=n.ensureLands)&&void 0!==e||(n.ensureLands=r.int(0,2));let s=[d,a,h].reduce(((e,r)=>r(e,n,this)),this.cards);this.cards=s,this._shuffleStarting=!0}shuffle(e){t(this.options()).arrayShuffle(this.cards,!0)}}exports.DeckLibraryWithShuffle=f,exports.default=f,exports.distributeCards=d,exports.ensureLands=h,exports.splitThenMerge=a;
//# sourceMappingURL=index.cjs.production.min.js.map
