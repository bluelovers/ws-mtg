"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("mtg-decklist-to-library"),r=require("random-extra/preset/seedrandom"),n=require("array-chunk-split"),s=require("mtg-base-land"),t=require("array-group-to-record"),a=require("distribute-group-to-array");function o(e){var n;return null!==(n=null==e?void 0:e.random)&&void 0!==n?n:r.seedrandom}function u(e,r,s){let t=function(e,r){return n.arrayChunkSplit(e,null!=r?r:12)}(e,null==r?void 0:r.maxChunkLength);return o(r).arrayShuffle(t,!0).flat()}function i(e){return e.reduce(((e,r)=>{let n=s.parseSnowCoveredOrBaseLand(r.name);return n?null!=n&&n.snow?e.snowLands.push(r):e.baseLands.push(r):e.others.push(r),e}),{baseLands:[],snowLands:[],others:[]})}function d(e){return t.arrayGroupToRecord(e,{getKey:(e,r,n)=>e.name})}function l(e){return a.distributeGroupToArray(e,{groupArraySize:4})}function h(e,r,n){let s=i(e),t=a._createGroupArray(4),o=0;for(s.baseLands=l(d(s.baseLands)),s.snowLands=l(d(s.snowLands));s.baseLands.length||s.snowLands.length||s.others.length;){for(let e=0;e<4;e++){let r=s.others.pop();var u,h;t[e].push(r),r&&o%4!=0||(t[e].push(null!==(u=s.baseLands.pop())&&void 0!==u?u:s.snowLands.pop()),t[e].push(null!==(h=s.baseLands.pop())&&void 0!==h?h:s.snowLands.pop()))}o++}return t.flat().filter((e=>e))}function p(e,r,n){let t;if(e=e.slice(),!1===(null==r?void 0:r.ensureLands))return e;if(t=!0===(null==r?void 0:r.ensureLands)?2:Math.max(Math.min(2,0|(null==r?void 0:r.ensureLands)||2),0),n.handSize<6||t<=0)return e;6===n.handSize&&(t=1);const a=e.slice(0,n.handSize),u=i(a),d=u.snowLands.length+u.baseLands.length-t;if(d>0){const t=function(e,r){return r|=0,e.reduce(((e,n,t)=>(t>=r&&s.parseSnowCoveredOrBaseLand(n.name)&&e.push(t),e)),[])}(e,n.handSize),i=o(r),l=i.dfArrayUnique(t,d);let h=i.dfArrayUnique(u.others,d);for(let r=0;r<d;r++){const r=h(),n=l(),s=a.findIndex((e=>e.name===r.name));if(-1===s)throw new Error("Something wrong");const t=e[n];e[n]=e[s],a[s]=e[s]=t}}return e}class f extends e.DeckLibrary{constructor(e,r){super(e,r)}options(e){return{...this._options,...e}}shuffleStarting(){var e;let r=this.options();const n=o(r);null!==(e=r.ensureLands)&&void 0!==e||(r.ensureLands=n.int(0,2));let s=[h,u,p].reduce(((e,n)=>n(e,r,this)),this.cards);this.cards=s,this._shuffleStarting=!0}shuffle(e){o(this.options()).arrayShuffle(this.cards,!0)}}exports.DeckLibraryWithShuffle=f,exports.default=f,exports.distributeCards=h,exports.ensureLands=p,exports.splitThenMerge=u;
//# sourceMappingURL=index.cjs.production.min.js.map
